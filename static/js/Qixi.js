var Qixi=function(){var y={keepZoomRatio:false,layer:{"width":"100%","height":"100%","top":0,"left":0},audio:{enable:true,playURl:"static/music/happy.wav",cycleURL:"static/music/circulation.wav"},setTime:{walkToThird:6000,walkToMiddle:6500,walkToEnd:6500,walkTobridge:2000,bridgeWalk:2000,walkToShop:1500,walkOutShop:1500,openDoorTime:800,shutDoorTime:500,waitRotate:850,waitFlower:800},snowflakeURl:["static/images/snowflake/snowflake1.png","static/images/snowflake/snowflake2.png","static/images/snowflake/snowflake3.png","static/images/snowflake/snowflake4.png","static/images/snowflake/snowflake5.png","static/images/snowflake/snowflake6.png"]};var q=0;if(q){$.each(y.setTime,function(z,A){y.setTime[z]=500})}if(y.keepZoomRatio){var m=900/1440;var w=$(document).height();var p=w*m;var n=(w-p)/2;y.layer.height=p;y.layer.top=n}var u;var o=$("#content");o.css(y.layer);var c=o.width();var g=o.height();var b=function(A){var z=$(""+A+"");return{height:z.height(),top:z.position().top}};var f=function(){var z=b(".a_background_middle");return z.top+z.height/2}();var h=function(){var z=b(".c_background_middle");return z.top}();var k=(function(){var z=navigator.userAgent;if(~z.indexOf("WebKit")){return"webkitAnimationEnd"}return"animationend"})();if(y.audio.enable){var s=i(y.audio.playURl);s.end(function(){i(y.audio.cycleURL,true)})}var t=Swipe(o);function a(B,A){var z=c*A;t.scrollTo(z,B)}var x={elem:$(".girl"),getHeight:function(){return this.elem.height()},rotate:function(){this.elem.addClass("girl-rotate")},setOffset:function(){this.elem.css({left:c/2,top:h-this.getHeight()})},getOffset:function(){return this.elem.offset()},getWidth:function(){return this.elem.width()}};var j={elem:$(".bird"),fly:function(){this.elem.addClass("birdFly");this.elem.transition({right:c},15000,"linear")}};var e={elem:$(".logo"),run:function(){this.elem.addClass("logolightSpeedIn").on(k,function(){$(this).addClass("logoshake").off()})}};var l=r();l.walkTo(y.setTime.walkToThird,0.6).then(function(){a(y.setTime.walkToMiddle,1);return l.walkTo(y.setTime.walkToMiddle,0.5)}).then(function(){j.fly()}).then(function(){l.stopWalk();return v(l)}).then(function(){x.setOffset();a(y.setTime.walkToEnd,2);return l.walkTo(y.setTime.walkToEnd,0.15)}).then(function(){return l.walkTo(y.setTime.walkTobridge,0.25,(h-x.getHeight())/g)}).then(function(){var z=(x.getOffset().left-l.getWidth()-u+x.getWidth()/5)/c;return l.walkTo(y.setTime.bridgeWalk,z)}).then(function(){l.resetOriginal();setTimeout(function(){x.rotate();l.rotate(function(){e.run();d()})},y.setTime.waitRotate)});function r(){var z=$("#boy");var H=z.width();var B=z.height();z.css({top:f-B+25});function C(){z.addClass("pauseWalk")}function D(){z.removeClass("pauseWalk")}function I(){z.addClass("slowWalk")}function J(L,K){var M=$.Deferred();D();z.transition(L,K,"linear",function(){M.resolve()});return M}function F(M,N,K){M=M||3000;I();var L=J({"left":N+"px","top":K?K:undefined},M);return L}function A(O){var R=$.Deferred();var P=$(".door");var L=P.offset();var K=L.left;var N=z.offset();var Q=N.left;u=(K+P.width()/2)-(Q+z.width()/2);var M=J({transform:"translateX("+u+"px),scale(0.3,0.3)",opacity:0.1},2000);M.done(function(){z.css({opacity:0});R.resolve()});return R}function E(L){var M=$.Deferred();D();var K=J({transform:"translate("+u+"px,0px),scale(1,1)",opacity:1},L);K.done(function(){M.resolve()});return M}function G(L,K){return(L==="x"?c:g)*K}return{walkTo:function(O,N,L){var M=G("x",N);var K=G("y",L);return F(O,M,K)},stopWalk:function(){C()},resetOriginal:function(){this.stopWalk();z.removeClass("slowWalk slowFlolerWalk").addClass("boyOriginal")},toShop:function(){return A.apply(null,arguments)},outShop:function(){return E.apply(null,arguments)},rotate:function(K){D();z.addClass("boy-rotate");if(K){z.on(k,function(){K();$(this).off()})}},getWidth:function(){return z.width()},getDistance:function(){return z.offset().left},talkFlower:function(){z.addClass("slowFlolerWalk")}}}var v=function(G){var z=$.Deferred();var F=$(".door");var I=$(".door-left");var C=$(".door-right");function H(O,L,N){var P=$.Deferred();var M=2;var K=function(){if(M===1){P.resolve();return}M--};I.transition({"left":O},N,K);C.transition({"left":L},N,K);return P}function J(K){return H("-50%","100%",K)}function E(K){return H("0%","50%",K)}function B(){var K=$.Deferred();G.talkFlower();setTimeout(function(){K.resolve()},y.setTime.waitFlower);return K}var A={elem:$(".b_background"),bright:function(){this.elem.addClass("lamp-bright")},dark:function(){this.elem.removeClass("lamp-bright")}};var D=J(y.setTime.openDoorTime);D.then(function(){A.bright();return G.toShop(F,y.setTime.walkToShop)}).then(function(){return B()}).then(function(){return G.outShop(y.setTime.walkOutShop)}).then(function(){E(y.setTime.shutDoorTime);A.dark();z.resolve()});return z};function d(){var A=$("#snowflake");function B(){return y.snowflakeURl[[Math.floor(Math.random()*6)]]}function z(){var C=B();return $('<div class="snowbox" />').css({"width":41,"height":41,"position":"absolute","backgroundSize":"cover","zIndex":100000,"top":"-41px","backgroundImage":"url("+C+")"}).addClass("snowRoll")
}setInterval(function(){var E=Math.random()*c-100,C=1;endPositionTop=g-40,endPositionLeft=E-100+Math.random()*500,duration=g*10+Math.random()*5000;var D=Math.random();D=D<0.5?C:D;var F=z();F.css({left:E,opacity:D});A.append(F);F.transition({top:endPositionTop,left:endPositionLeft,opacity:0.7},duration,"ease-out",function(){$(this).remove()})},200)}function i(A,z){var B=new Audio(A);B.autoplay=true;B.loop=z||false;B.play();return{end:function(C){B.addEventListener("ended",function(){C()},false)}}}};$(function(){Qixi()});function Swipe(b,k){var e=b.find(":first");var f={};var a=e.find(">");var d=b.width();var j=b.height();e.css({width:(a.length*d)+"px",height:j+"px"});$.each(a,function(m){var l=a.eq[m];a.eq(m).css({width:d+"px",height:j+"px"})});var i=false;var c;var g={};b[0].addEventListener("transitionend",function(){i=true},false);function h(l){c=setTimeout(function(){if(i){clearInterval(c);return}g.move(l.offset().left);h(l)},500)}f.watch=function(l,m){g[l]=m};f.scrollTo=function(l,m){e.css({"transition-timing-function":"linear","transition-duration":m+"ms","transform":"translate3d(-"+l+"px,0px,0px)"});return this};return f};